<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>README</title>
  <link rel="stylesheet" href="/css/variables.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/sidebar.css" />
  <link rel="stylesheet" href="/css/main-content.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/lightbox.css" />
  <link rel="stylesheet" href="/css/scroll-to-top.css" />
  <link rel="stylesheet" href="/css/settings-modal.css" />
  <link rel="stylesheet" href="/css/videoplay.css" />
  <link rel="stylesheet" href="/css/input.css" />
  <script src="/js/theme.js" defer></script>
  <script src="/js/sidebar.js" defer></script>
  <script src="/js/header.js" defer></script>
  <script src="/js/settings-modal.js" defer></script>
  <script src="/js/lightbox.js" defer></script>
  <script src="/js/scroll-to-top.js" defer></script>
  <script src="/js/search.js" defer></script>
  <script src="/js/videoplay.js" defer></script>
  <script src="/js/spa-router.js" type="module"></script>
  <script>
    document.documentElement.classList.add('readme-page');
  </script>
</head>
<body>
  <div id="shell-root"></div>
  <script>
    (function loadShell() {
      var root = document.getElementById('shell-root');
      if (!root) return;
      var inlineShell = '\n  <header id="site-header"></header>\n  <aside id="sidebar"></aside>\n  <footer id="site-footer"></footer>\n';

      function arrangeShell(){
        var main = document.getElementById('page-root');
        var header = root.querySelector('header');
        var sidebar = root.querySelector('nav.sidebar');
        var aside = root.querySelector('aside');
        var footer = root.querySelector('footer');

        // Promote shell children to body so layout matches other pages
        if (header && header.parentNode !== document.body && main) {
          document.body.insertBefore(header, main);
        }
        if (sidebar && sidebar.parentNode !== document.body && main) {
          document.body.insertBefore(sidebar, main);
        }

        if (aside) {
          aside.setAttribute('data-shell-preserve','1');
          if (main && aside.parentNode !== main) {
            aside.remove();
            main.appendChild(aside);
          }
        }
        if (footer) {
          var target = aside || main;
          if (target && footer.parentNode !== document.body) {
            footer.remove();
            document.body.insertBefore(footer, target.nextSibling);
          } else if (target && footer.previousElementSibling !== target) {
            target.insertAdjacentElement('afterend', footer);
          }
        }

        if (window.refreshAsideStack) {
          window.refreshAsideStack();
        }
      }

      try {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/includes/shell.html', false);
        xhr.send(null);
        if (xhr.status >= 200 && xhr.status < 300 && xhr.responseText) {
          root.innerHTML = xhr.responseText;
          arrangeShell();
          if (window.refreshAsideStack) { window.refreshAsideStack(); }
          return;
        }
      } catch (e) {}
      fetch('/includes/shell.html').then(function(resp) {
        if (!resp.ok) throw new Error('shell fetch failed');
        return resp.text();
      }).then(function(html) {
        root.innerHTML = html;
        arrangeShell();
        if (window.refreshAsideStack) { window.refreshAsideStack(); }
      }).catch(function() {
        root.innerHTML = inlineShell;
        arrangeShell();
        if (window.refreshAsideStack) { window.refreshAsideStack(); }
      });
    })();
  </script>

  <main id="page-root">
    <section class="readme-content">
      <div id="readme-loader">Loading README...</div>
      <article id="readme-body"></article>
    </section>
  </main>

  <script src="/js/vendor/marked.min.js"></script>
  <script src="/js/vendor/purify.min.js"></script>
  <script>
    (function() {
      var readmePath = '/README.md';
      var bodyEl = document.getElementById('readme-body');
      var loaderEl = document.getElementById('readme-loader');

      function renderReadme(mdText) {
        if (!window.marked) {
          bodyEl.textContent = 'Markdown renderer unavailable';
          return;
        }
        var html = window.marked.parse(mdText || '');
        if (window.DOMPurify && window.DOMPurify.sanitize) {
          html = window.DOMPurify.sanitize(html);
        }
        bodyEl.innerHTML = html;
      }

      function loadReadme() {
        fetch(readmePath).then(function(resp) {
          if (!resp.ok) throw new Error('Failed to load README');
          return resp.text();
        }).then(function(text) {
          if (loaderEl) loaderEl.remove();
          renderReadme(text);
        }).catch(function(err) {
          if (loaderEl) loaderEl.textContent = err.message || 'Unable to load README';
        });
      }

      window.addEventListener('spa:page:loaded', loadReadme);
      loadReadme();
    })();
  </script>
</body>
</html>