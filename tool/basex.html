<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaseX 编解码</title>
    <meta name="author" content="滄海水魚">
    <meta name="description" content="在浏览器中完成 Base16/32/58/64/85/91 与 Unicode 文本互转，便于调试与数据交换。">
    <meta name="theme-color" content="#ffffff">

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/resource/img/shell/favicon.ico" type="image/x-icon">
    <link rel="preload" href="/resource/img/shell/favicon.ico" as="image" type="image/x-icon">
    <link rel="preload" href="/resource/img/shell/shuiyu.avif" as="image" type="image/avif">
    <link rel="preload" href="/resource/img/shell/bg/bg-light-1.png" as="image" type="image/png">
    <link rel="preload" href="/css/variables.css" as="style">
    <link rel="preload" href="/resource/font/FluentSystemIcons-Regular.woff2" as="font" type="font/woff2" crossorigin>

    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/input.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/main-content.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/lightbox.css">
    <link rel="stylesheet" href="/css/settings-modal.css">
    <link rel="stylesheet" href="/css/scroll-to-top.css">
    <link rel="stylesheet" href="/css/videoplay.css">
    <link rel="stylesheet" href="/css/column.css">
    <link rel="stylesheet" href="/css/project.css">
    <link rel="stylesheet" href="/css/tool-basex.css">
    <link rel="stylesheet" href="/resource/font/FluentSystemIcons-Regular.css">

    <script src="/js/pwa/register-sw.js" defer></script>
    <script src="/js/theme.js" defer></script>
    <script src="/js/sidebar.js" defer></script>
    <script src="/js/lightbox.js" defer></script>
    <script src="/js/avatar.js" defer></script>
    <script src="/js/scroll-to-top.js" defer></script>
    <script src="/js/search.js" defer></script>
    <script src="/js/spa-router.js" defer></script>
    <script src="/js/settings-modal.js" defer></script>

</head>

<body>
    <div id="shell-root"></div>
    <script>
        (function () {
            var container = document.getElementById('shell-root');
            function normalize(pathname) {
                var p = pathname.replace(/\/index\.html$/i, '/').replace(/\.html$/i, '').replace(/\/+$/, '');
                return p === '' ? '/' : p;
            }
            function markCurrentNav() {
                var current = normalize(location.pathname);
                var sidebar = document.getElementById('sidebar');
                if (!sidebar) return;
                sidebar.querySelectorAll('.current, .selected').forEach(function (el) {
                    el.classList.remove('current', 'selected');
                    if (el.tagName === 'A') el.removeAttribute('aria-current');
                });
                document.querySelectorAll('#sidebar a[href]').forEach(function (a) {
                    var href = a.getAttribute('href');
                    if (!href) return;
                    var target = normalize(new URL(href, location.origin).pathname);
                    if (target === current) {
                        var parent = a.closest('.has-children');
                        var toggle = parent ? parent.querySelector('.toggle') : null;
                        var submenu = parent ? parent.querySelector('.submenu') : null;
                        var parentOpen = !!(parent && parent.classList.contains('open'));

                        if (parent && !parentOpen) {
                            parent.classList.add('current');
                            if (toggle) toggle.classList.add('current');
                            return;
                        }

                        a.classList.add('current', 'selected');
                        a.setAttribute('aria-current', 'page');
                        if (parent) {
                            if (toggle) {
                                toggle.classList.add('current');
                                toggle.setAttribute('aria-expanded', 'true');
                            }
                            if (submenu) submenu.style.maxHeight = submenu.scrollHeight + 'px';
                        }
                    }
                });
            }
            function attachShell(html) {
                if (!container || !html) return;
                container.innerHTML = html;
                var move = function () {
                    var main = document.querySelector('main');
                    if (!main) return;
                    var aside = container.querySelector('aside');
                    var footer = container.querySelector('footer');
                    if (aside && !main.contains(aside)) {
                        aside.setAttribute('data-shell-moved', '1');
                        main.appendChild(aside);
                    }
                    if (footer && footer.parentNode !== main.parentNode) {
                        footer.setAttribute('data-shell-moved', '1');
                        main.insertAdjacentElement('afterend', footer);
                    }
                    if (window.refreshAsideStack) {
                        window.refreshAsideStack();
                    }
                    markCurrentNav();
                };
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', move, { once: true });
                } else {
                    move();
                }
            }
            function bust(url) {
                if (location.protocol === 'file:') return url;
                var sep = url.indexOf('?') === -1 ? '?' : '&';
                return url + sep + 'ts=' + Date.now();
            }
            try {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', bust('/includes/shell.html'), false);
                xhr.send(null);
                if (xhr.status === 200 || xhr.status === 0) {
                    attachShell(xhr.responseText);
                    return;
                }
            } catch (e) {}
            fetch(bust('/includes/shell.html'), { cache: 'no-store' })
                .then(function(resp){ return resp.ok ? resp.text() : Promise.reject(new Error('HTTP '+resp.status)); })
                .then(function(html){ attachShell(html); });
        })();
    </script>

    <main>
        <div class="column-stack">
            <section class="article-card">
                <p class="eyebrow">工具</p>
                <h1>BaseX 编解码</h1>
                <p class="article-subtitle">在同一面板完成 Base16 / Base32 / Base58 / Base64 / Base85 / Base91 与 UTF-8 文本互转，方便调试接口、协议与嵌入式配置。</p>
                <div class="article-meta">
                    <span class="pill"><i class="icon-ic_fluent_arrow_sync_24_regular" aria-hidden="true"></i> 双向转换</span>
                    <span class="pill"><i class="icon-ic_fluent_globe_24_regular" aria-hidden="true"></i> UTF-8 支持</span>
                    <span class="pill"><i class="icon-ic_fluent_checkmark_circle_24_regular" aria-hidden="true"></i> 多基数</span>
                </div>
                <div class="article-actions">
                    <a href="#tool-panel">立即使用</a>
                    <a href="#howto">如何使用</a>
                </div>
            </section>

            <section class="article-card basex-tool-card" id="tool-panel">
                <div class="basex-tool-panel">
                    <p class="eyebrow">工具面板</p>
                    <h2>BaseX 编解码器</h2>
                    <p class="article-subtitle">选择基数后，将文本与对应的 BaseX 字符串互转，支持常见 6 种基数方案。</p>
                    <div class="basex-mode-row">
                        <div>
                            <label for="basex-mode">选择基数</label>
                            <p class="field-hint">Base16 / Base32 / Base58 / Base64 / Base85 / Base91</p>
                        </div>
                        <input type="hidden" id="basex-mode" value="base64">
                        <div class="settings-dropdown basex-dropdown" data-open="false">
                            <button type="button" class="settings-dropdown-toggle" id="basex-mode-toggle" aria-haspopup="listbox" aria-expanded="false">
                                <span class="toggle-label" id="basex-mode-label">Base64</span>
                                <i class="toggle-icon icon-ic_fluent_chevron_right_24_regular" aria-hidden="true"></i>
                            </button>
                            <div class="settings-dropdown-list" id="basex-mode-list" role="listbox">
                                <div class="dropdown-item" role="option" data-value="base16">Base16（Hex）</div>
                                <div class="dropdown-item" role="option" data-value="base32">Base32</div>
                                <div class="dropdown-item" role="option" data-value="base58">Base58</div>
                                <div class="dropdown-item selected" role="option" data-value="base64" aria-selected="true">Base64</div>
                                <div class="dropdown-item" role="option" data-value="base85">Base85（Ascii85）</div>
                                <div class="dropdown-item" role="option" data-value="base91">Base91</div>
                            </div>
                        </div>
                    </div>
                    <div class="tool-panel-grid">
                        <div>
                            <label for="basex-input">输入区</label>
                            <p class="field-hint">输入 UTF-8 文本或 BaseX 字符串（可包含空格、换行）。</p>
                            <div class="basex-textarea-wrapper">
                                <textarea id="basex-input" spellcheck="false" rows="6" placeholder="粘贴或键入原文 / BaseX 字符串，选择操作后查看输出。"></textarea>
                                <button type="button" class="copy-btn basex-copy-btn" data-copy-target="basex-input" aria-label="复制输入内容">
                                    <span class="fluent-icon icon-ic_fluent_copy_24_regular" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="basex-output">输出区</label>
                            <p class="field-hint">操作完成后自动填充，可直接复制使用。</p>
                            <div class="basex-textarea-wrapper">
                                <textarea id="basex-output" rows="6" readonly spellcheck="false"></textarea>
                                <button type="button" class="copy-btn basex-copy-btn" data-copy-target="basex-output" aria-label="复制输出内容">
                                    <span class="fluent-icon icon-ic_fluent_copy_24_regular" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="basex-tool-actions">
                        <button type="button" data-basex-action="encode">编码为 BaseX</button>
                        <button type="button" data-basex-action="decode">解码为文本</button>
                        <button type="button" data-basex-action="clear">清空</button>
                    </div>
                    <div id="basex-feedback" class="basex-tool-feedback" aria-live="polite" data-state="info">等待操作</div>
                </div>
            </section>

            <section class="article-card" id="howto">
                <h2>如何使用</h2>
                <ul>
                    <li>选择基数：先从下拉框选中需要的 Base16/32/58/64/85/91 方案。</li>
                    <li>编码：填入任意文本，点击「编码为 BaseX」，输出对应的基数字符串。</li>
                    <li>解码：粘贴合法的 BaseX 字符串（可含空格换行），点击「解码为文本」。</li>
                    <li>清空：重置输入与输出，便于切换测试场景。</li>
                </ul>
            </section>

            <section class="article-card">
                <h2>提示</h2>
                <p>Base 编码仅做可逆映射，不提供加密能力。若需要保护敏感信息，请使用具备密钥管理与认证的加密方案。</p>
                <p>部分基数（如 Base85/91）在不同实现间存在细微差异，本页面采用常见的 Ascii85 与 Joachim Henke Base91 算法，便于与多数工具兼容。</p>
            </section>

        </div>
        <script src="/js/tool/basex.js" defer></script>
    </main>
    </body>

</html>
